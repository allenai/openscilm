import React, { useCallback } from 'react';
import {  
  Box,
  Typography,
  Link
} from '@mui/material';
import MessageBar from '../components/widgets/MessageBar';
import { useNavigate } from "react-router-dom";
import { CircularProgress } from '@mui/material';

import { createTask } from '../api/utils';
import { useQueryHistory } from '../components/shared';

export const Home = () => {

  const navigate = useNavigate();

  const {history, setHistory} = useQueryHistory();

  const [isLoading, setIsLoading] = React.useState<boolean>(false);

  const handleSubmit = useCallback(async (query: string, optin: boolean = false) => {
    console.log(query)
    setIsLoading(true);
    setIsLoading(false);

    const newStatus = await createTask(query, optin);
    console.log(newStatus, newStatus.task_id);
    if (newStatus.task_id) {
      navigate(`/query/${newStatus.task_id}`, { replace: true });
      if (!history[newStatus.task_id]) {
        setHistory({
          ...history,
          [newStatus.task_id]: {
            query: newStatus.query, taskId: newStatus.task_id, timestamp: Date.now()
          }
        });
      }
    }
  }, []);

  return (
    <>
      <Box sx={{ alignItems:'center', display: 'flex', flexGrow: '1', flexDirection: 'column', justifyContent: 'center', padding: '32px', width: '100%', paddingTop: '240px'}}>
        <Box sx={{maxWidth: '800px', width: '100%', display: 'flex', flexDirection: 'column', gap: '12px'}}>
          
          <Box sx={{display: `flex`, justifyContent: 'space-between', alignItems: 'baseline'}}>
          <svg xmlns="http://www.w3.org/2000/svg" height="42" viewBox="0 0 1675.12 169.97">
            <path fill="#ef529b" d="M49.7,55.47h-24.85v-24.03h20c2.67,0,4.84-2.21,4.84-4.92V6.19h23.64v25.26c0,13.27-10.58,24.03-23.64,24.03ZM24.85,57.93H0v24.03h20c2.67,0,4.84,2.21,4.84,4.92v20.33h23.64v-25.26c0-13.27-10.58-24.03-23.64-24.03ZM104.24,56.7c-2.67,0-4.85-2.21-4.85-4.92v-20.33h-23.64v25.26c0,13.27,10.58,24.03,23.64,24.03h24.85v-24.03h-20ZM50.91,107.21v25.26h23.64v-20.33c0-2.71,2.17-4.92,4.84-4.92h20v-24.03h-24.85c-13.06,0-23.64,10.75-23.64,24.03Z"/>
            <path fill="#ef529b" d="M1620.16,37.77h18.7v22.85c6.55-16.24,17.69-24.36,33.43-24.36h2.83v18.32h-4.72c-11.96,0-20.21,3.46-24.74,10.39-4.41,6.8-6.61,17.19-6.61,31.16v36.07h-18.89V37.77Z"/>
            <path fill="#ef529b" d="M1545.16,134.65c-9.7,0-17.38-2.46-23.04-7.37-5.54-4.91-8.31-11.71-8.31-20.4,0-7.81,2.2-14.04,6.61-18.7,4.53-4.78,11.89-8.06,22.09-9.82l23.61-3.97c4.66-.76,7.99-1.95,10.01-3.59,2.14-1.64,3.21-4.09,3.21-7.37,0-4.66-1.58-8.18-4.72-10.58-3.03-2.52-8.38-3.78-16.06-3.78s-13.47,1.51-17.37,4.53c-3.78,3.02-5.92,7.55-6.42,13.6h-18.89c.13-10.2,3.84-18.19,11.15-23.98,7.3-5.79,17.56-8.69,30.78-8.69s22.35,2.64,28.89,7.93c6.68,5.29,10.01,12.4,10.01,21.34v46.83c0,6.93.32,14.1.95,21.53h-17.19c-.75-7.43-1.13-14.54-1.13-21.34-2.14,6.8-6.05,12.46-11.71,17-5.67,4.53-13.16,6.8-22.47,6.8ZM1532.69,106.13c0,4.41,1.45,7.87,4.35,10.39,3.02,2.39,7.05,3.59,12.08,3.59,9.57,0,17-3.15,22.29-9.44,5.28-6.42,7.93-14.54,7.93-24.36v-5.67c-2.27,1.64-4.72,2.96-7.37,3.97-2.64.88-5.79,1.76-9.44,2.64l-13.03,3.02c-5.92,1.38-10.2,3.34-12.84,5.85-2.65,2.39-3.97,5.73-3.97,10.01Z"/>
            <path fill="#ef529b" d="M1474.1,0h18.89v132.2h-18.89V0Z"/>
            <path fill="#ef529b" d="M1405.74,135.22c-10.57,0-19.51-2.2-26.81-6.61-7.31-4.41-12.78-10.39-16.43-17.94-3.65-7.68-5.48-16.3-5.48-25.87s1.83-17.94,5.48-25.49c3.65-7.55,9.12-13.53,16.43-17.94,7.3-4.41,16.24-6.61,26.81-6.61s19.52,2.2,26.82,6.61c7.3,4.41,12.78,10.45,16.43,18.13,3.65,7.55,5.48,15.99,5.48,25.31s-1.83,18-5.48,25.68c-3.65,7.55-9.13,13.6-16.43,18.13-7.3,4.41-16.24,6.61-26.82,6.61ZM1376.09,84.98c0,12.46,2.33,21.47,6.99,27.01,4.79,5.41,12.34,8.12,22.66,8.12s17.82-2.71,22.48-8.12c4.78-5.54,7.17-14.54,7.17-27.01s-2.39-21.4-7.17-26.82c-4.66-5.54-12.15-8.31-22.48-8.31s-17.87,2.77-22.66,8.31c-4.66,5.41-6.99,14.35-6.99,26.82Z"/>
            <path fill="#ef529b" d="M1252.06,0h18.88v58.92c6.55-16.12,17.94-24.17,34.18-24.17,12.22,0,20.97,3.21,26.25,9.63,5.42,6.42,8.13,16.05,8.13,28.89v58.92h-18.89v-57.22c0-9.19-1.83-15.55-5.48-19.07-3.65-3.65-8.81-5.48-15.48-5.48-9.57,0-16.75,3.34-21.53,10.01-4.79,6.67-7.18,17.31-7.18,31.92v39.85h-18.88V0Z"/>
            <path fill="#ef529b" d="M1138.85,84.98c0-9.57,1.82-18.13,5.47-25.68,3.78-7.55,9.26-13.53,16.43-17.94,7.31-4.41,16.12-6.61,26.44-6.61,14.23,0,25.18,3.53,32.86,10.58,7.81,6.92,11.96,16.18,12.47,27.76h-17.76c-.88-6.92-3.46-12.53-7.74-16.81s-10.64-6.42-19.07-6.42c-9.7,0-17.12,2.77-22.29,8.31-5.16,5.41-7.74,14.35-7.74,26.82s2.52,21.59,7.55,27.01c5.04,5.41,12.41,8.12,22.1,8.12,8.69,0,15.3-2.2,19.83-6.61,4.66-4.53,7.43-10.45,8.31-17.75h17.75c-.25,7.18-2.2,13.79-5.85,19.83-3.53,5.92-8.69,10.7-15.49,14.35-6.8,3.53-14.98,5.29-24.55,5.29-10.32,0-19.14-2.2-26.44-6.61-7.3-4.41-12.84-10.39-16.62-17.94-3.77-7.55-5.66-16.12-5.66-25.68Z"/>
            <path fill="#ef529b" d="M1037.7,90.08c.63,20.02,12.71,30.03,36.26,30.03,11.83,0,20.02-1.83,24.55-5.48,4.53-3.65,6.8-9,6.8-16.05,0-5.79-1.77-10.32-5.29-13.6-3.4-3.4-8.69-5.6-15.86-6.61l-29.09-4.15c-21.65-3.02-32.48-14.29-32.48-33.8,0-11.08,4.15-20.02,12.46-26.82,8.31-6.92,20.53-10.39,36.64-10.39s29.34,3.71,37.77,11.14c8.56,7.3,13.28,17,14.17,29.08h-18.89c-1.01-7.93-4.22-14.1-9.63-18.51-5.41-4.41-13.28-6.61-23.61-6.61s-17.18,1.95-22.09,5.85c-4.79,3.78-7.18,9-7.18,15.67,0,4.78,1.39,8.75,4.16,11.9,2.77,3.02,6.98,4.97,12.65,5.85l30.78,4.53c11.46,1.64,20.14,5.22,26.06,10.76,6.05,5.41,9.07,13.16,9.07,23.23,0,26.06-17,39.09-50.99,39.09-19.14,0-33.11-4.22-41.93-12.65-8.81-8.56-13.22-19.39-13.22-32.48h18.89Z"/>
            <path fill="#ef529b" d="M866.24,37.77h18.89v21.15c6.55-16.12,17.94-24.17,34.18-24.17,12.21,0,20.96,3.21,26.25,9.63,5.41,6.42,8.12,16.05,8.12,28.89v58.92h-18.89v-57.22c0-9.19-1.83-15.55-5.48-19.07-3.65-3.65-8.81-5.48-15.49-5.48-9.57,0-16.74,3.34-21.53,10.01-4.78,6.67-7.18,17.31-7.18,31.92v39.85h-18.89V37.77Z"/>
            <path fill="#ef529b" d="M802.1,135.22c-15.99,0-27.95-4.66-35.88-13.97-7.93-9.32-11.9-21.47-11.9-36.45,0-9.44,1.76-17.94,5.29-25.49,3.52-7.55,8.88-13.53,16.05-17.94,7.18-4.41,15.99-6.61,26.44-6.61,9.69,0,17.94,2.14,24.74,6.42,6.92,4.15,12.09,9.88,15.49,17.19,3.52,7.3,5.29,15.55,5.29,24.74,0,3.15-.13,5.54-.38,7.18h-74.41c.76,11.2,3.71,19.2,8.88,23.98,5.16,4.66,12.15,6.99,20.96,6.99,15.11,0,24.23-5.85,27.38-17.56h17.37c-1.13,8.31-5.29,15.67-12.46,22.1-7.05,6.29-18,9.44-32.86,9.44ZM829.48,76.48c-.88-18.51-9.95-27.76-27.19-27.76-8.56,0-15.3,2.14-20.21,6.42-4.91,4.15-7.93,11.27-9.07,21.34h56.47Z"/>
            <path fill="#ef529b" d="M696.17,135.22c-16.62,0-28.26-6.42-34.94-19.26v54.01h-18.88V37.77h18.88v16.24c6.67-12.84,18.32-19.26,34.94-19.26,14.48,0,25.43,4.72,32.86,14.16,7.43,9.32,11.14,21.34,11.14,36.07s-3.71,26.82-11.14,36.26c-7.43,9.32-18.38,13.97-32.86,13.97ZM661.23,84.98c0,23.42,10.32,35.13,30.97,35.13,10.32,0,17.69-2.83,22.09-8.5,4.53-5.79,6.8-14.67,6.8-26.63s-2.27-20.77-6.8-26.44c-4.41-5.79-11.77-8.69-22.09-8.69-20.65,0-30.97,11.71-30.97,35.13Z"/>
            <path fill="#ef529b" d="M558.68,135.41c-21.4,0-37.39-6.04-47.97-18.13-10.45-12.21-15.67-28.2-15.67-47.97,0-12.59,2.2-23.86,6.61-33.8,4.53-9.95,11.52-17.81,20.96-23.61,9.57-5.79,21.59-8.69,36.07-8.69s26.44,2.9,35.88,8.69c9.57,5.79,16.56,13.66,20.96,23.61,4.53,9.95,6.8,21.21,6.8,33.8s-2.27,24.05-6.8,33.99c-4.41,9.95-11.39,17.81-20.96,23.61-9.44,5.67-21.4,8.5-35.88,8.5ZM515.43,69.31c0,16.87,3.4,29.46,10.2,37.77,6.92,8.18,17.94,12.27,33.05,12.27s26.06-4.09,32.86-12.27c6.92-8.31,10.39-20.9,10.39-37.77s-3.46-29.4-10.39-37.58c-6.8-8.31-17.75-12.46-32.86-12.46s-26.12,4.15-33.05,12.46c-6.8,8.18-10.2,20.71-10.2,37.58Z"/>
            <path fill="#ef529b" d="M330.48,116.52l64.21-51.93c5.29-4.28,8.88-8.25,10.76-11.9,2.02-3.65,3.02-7.93,3.02-12.84,0-6.17-2.01-11.14-6.04-14.92-3.9-3.78-10.01-5.67-18.32-5.67-11.71,0-20.27,3.34-25.68,10.01-5.29,6.55-7.93,15.67-7.93,27.38h-20.4c.25-14.73,4.47-27.32,12.65-37.77,8.18-10.45,21.97-15.67,41.36-15.67,15.61,0,26.94,3.46,33.99,10.39,7.18,6.92,10.76,15.61,10.76,26.06,0,8.18-2.45,15.74-7.36,22.66-4.91,6.92-13.16,14.92-24.74,23.98l-38.34,30.22h72.71v15.68h-100.66v-15.68Z"/>
            <path fill="#ef529b" d="M287.66,37.77h18.88v94.42h-18.88V37.77ZM285.21,6.61h23.8v17h-23.8V6.61Z"/>
            <path fill="#ef529b" d="M254.62,132.2l-11.14-29.84h-60.81l-11.14,29.84h-19.64L198.53,6.61h29.27l46.65,125.59h-19.83ZM237.63,86.68l-24.55-66.29-24.55,66.29h49.1Z"/>
          </svg>

            <Box sx={{display: 'flex', gap: '8px'}}>
              <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 58.2 42">
                <path fill="#FAF2E9" d="M58.2,12.8c-2.1,1.3-3.5,2-5.2,3C43,21.9,33.3,28.7,25.7,37.6L22.1,42L11,24.4c2.5,2,8.7,7.5,11.2,8.7 l8.1-6.1C36,23,52,14.3,58.2,12.8z"/>
                <path fill="#FAF2E9" d="M16.2,26l0.8,0.6C14.6,20,10.6,14,5.5,9.2H0C6.4,13.7,11.9,19.4,16.2,26L16.2,26z"/>
                <path fill="#FAF2E9" d="M18,27.6l0.7,0.5c-0.3-8.3-3.4-16.7-9.3-24H4.2C11.7,11.1,16.3,19.4,18,27.6z"/>
                <path fill="#FAF2E9" d="M19.5,28.8c0.8,0.7,1.7,1.3,2.4,1.8c1.8-9.2,0.2-18.7-4.6-26.8l24.5-0.3c1.8,4,2.9,8.4,3.2,12.9 c0.7-0.4,1.4-0.7,2.1-1.1c-0.3-4.5-1.6-9.4-4-15.2H9.6C16.9,8.6,20.2,19,19.5,28.8z"/>
              </svg>

              <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 62.46 42">
                <path fill="#FAF2E9" d="M45.84,0v7.58h5.32l-5.94,22.12S37.95.41,37.84,0h-7.69c-.11.4-7.98,29.7-7.98,29.7l-5.47-22.12h5.54V0H0v7.58h4.93s8.5,34.01,8.61,34.42h11.94c.11-.4,5.7-21.66,5.7-21.66,0,0,5.31,21.25,5.42,21.66h11.94c.11-.41,9.05-34.42,9.05-34.42h4.89V0h-16.62Z"/>
              </svg>
            </Box>
          </Box>

          <MessageBar onSend={handleSubmit} />

          <Typography variant="body2">A joint project between <Link href="https://www.semanticscholar.org" target="_blank" sx={{ color: 'rgba(15, 203, 140, 1)' }}>Semantic Scholar</Link> and the <Link href="https://www.washington.edu" target="_blank" sx={{ color: 'rgba(15, 203, 140, 1)' }}>University of Washington</Link></Typography>

          <div>
            {isLoading && <CircularProgress />}
          </div>
        </Box>
      </Box>
    </>
  );
};
