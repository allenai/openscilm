import React, { useCallback } from 'react';
import {  
  Box,
} from '@mui/material';
import MessageBar from '../components/widgets/MessageBar';
import { useNavigate } from "react-router-dom";
import { CircularProgress } from '@mui/material';

import { createTask } from '../api/utils';
import { useQueryHistory } from '../components/shared';

export const Home = () => {

  const navigate = useNavigate();

  const {history, setHistory} = useQueryHistory();

  const [isLoading, setIsLoading] = React.useState<boolean>(false);

  const handleSubmit = useCallback(async (query: string, optin: boolean = false) => {
    console.log(query)
    setIsLoading(true);
    setIsLoading(false);

    const newStatus = await createTask(query, optin);
    console.log(newStatus, newStatus.task_id);
    if (newStatus.task_id) {
      navigate(`/query/${newStatus.task_id}`, { replace: true });
      if (!history[newStatus.task_id]) {
        setHistory({
          ...history,
          [newStatus.task_id]: {
            query: newStatus.query, taskId: newStatus.task_id, timestamp: Date.now()
          }
        });
      }
    }
  }, []);

  return (
    <>
      <Box sx={{ alignItems:'center', display: 'flex', flexGrow: '1', flexDirection: 'column', justifyContent: 'center', padding: '32px', width: '100%', paddingTop: '240px'}}>
        <Box sx={{maxWidth: '800px', width: '100%', display: 'flex', flexDirection: 'column', gap: '12px'}}>
          
          <Box sx={{display: `flex`, justifyContent: 'space-between'}}>
            <svg xmlns="http://www.w3.org/2000/svg" width="319" height="42" viewBox="0 0 600 79" fill="none">
              <path fill="#F0529C" d="M23.1,25.8H11.6V14.6h9.3c1.2,0,2.3-1,2.3-2.3V2.9h11v11.7C34.1,20.8,29.2,25.8,23.1,25.8z M11.6,26.9H0v11.2 h9.3c1.2,0,2.3,1,2.3,2.3v9.5h11V38.1C22.5,31.9,17.6,26.9,11.6,26.9z M48.5,26.4c-1.2,0-2.3-1-2.3-2.3v-9.5h-11v11.7 c0,6.2,4.9,11.2,11,11.2h11.6V26.4H48.5z M23.7,49.8v11.7h11v-9.5c0-1.3,1-2.3,2.3-2.3h9.3V38.7H34.7C28.6,38.7,23.7,43.7,23.7,49.8 z"/>
              <path fill="#F0529C" d="M574.5,17.6h8.7v10.6c3-7.6,8.2-11.3,15.5-11.3h1.3v8.5h-2.2c-5.6,0-9.4,1.6-11.5,4.8c-2,3.2-3.1,8-3.1,14.5 v16.8h-8.8V17.6z"/>
              <path fill="#F0529C" d="M539.6,62.6c-4.5,0-8.1-1.1-10.7-3.4c-2.6-2.3-3.9-5.4-3.9-9.5c0-3.6,1-6.5,3.1-8.7c2.1-2.2,5.5-3.7,10.3-4.6 l11-1.8c2.2-0.4,3.7-0.9,4.7-1.7c1-0.8,1.5-1.9,1.5-3.4c0-2.2-0.7-3.8-2.2-4.9c-1.4-1.2-3.9-1.8-7.5-1.8s-6.3,0.7-8.1,2.1 c-1.8,1.4-2.8,3.5-3,6.3H526c0.1-4.7,1.8-8.5,5.2-11.2c3.4-2.7,8.2-4,14.3-4c5.9,0,10.4,1.2,13.4,3.7c3.1,2.5,4.7,5.8,4.7,9.9v21.8 c0,3.2,0.1,6.6,0.4,10h-8c-0.4-3.5-0.5-6.8-0.5-9.9c-1,3.2-2.8,5.8-5.4,7.9C547.4,61.5,543.9,62.6,539.6,62.6z M533.8,49.3 c0,2,0.7,3.7,2,4.8c1.4,1.1,3.3,1.7,5.6,1.7c4.4,0,7.9-1.5,10.4-4.4c2.5-3,3.7-6.8,3.7-11.3v-2.6c-1.1,0.8-2.2,1.4-3.4,1.8 c-1.2,0.4-2.7,0.8-4.4,1.2l-6.1,1.4c-2.8,0.6-4.7,1.6-6,2.7C534.4,45.8,533.8,47.4,533.8,49.3z"/>
              <path fill="#F0529C" d="M506.5,0h8.8v61.5h-8.8V0z"/>
              <path fill="#F0529C" d="M474.8,62.9c-4.9,0-9.1-1-12.5-3.1c-3.4-2-5.9-4.8-7.6-8.3c-1.7-3.6-2.5-7.6-2.5-12c0-4.4,0.8-8.3,2.5-11.9 s4.2-6.3,7.6-8.3c3.4-2,7.5-3.1,12.5-3.1c4.9,0,9.1,1,12.5,3.1c3.4,2,5.9,4.9,7.6,8.4c1.7,3.5,2.5,7.4,2.5,11.8 c0,4.4-0.8,8.4-2.5,11.9c-1.7,3.5-4.2,6.3-7.6,8.4C483.8,61.8,479.7,62.9,474.8,62.9z M461,39.5c0,5.8,1.1,10,3.2,12.6 c2.2,2.5,5.7,3.8,10.5,3.8c4.8,0,8.3-1.3,10.4-3.8c2.2-2.6,3.3-6.8,3.3-12.6s-1.1-10-3.3-12.5c-2.2-2.6-5.6-3.9-10.4-3.9 c-4.8,0-8.3,1.3-10.5,3.9C462.1,29.6,461,33.7,461,39.5z"/>
              <path fill="#F0529C" d="M403.3,0h8.8v27.4c3-7.5,8.3-11.2,15.9-11.2c5.7,0,9.7,1.5,12.2,4.5c2.5,3,3.8,7.5,3.8,13.4v27.4h-8.8V34.9 c0-4.3-0.8-7.2-2.5-8.9c-1.7-1.7-4.1-2.5-7.2-2.5c-4.4,0-7.8,1.6-10,4.7c-2.2,3.1-3.3,8-3.3,14.8v18.5h-8.8V0z"/>
              <path fill="#F0529C" d="M350.7,39.5c0-4.4,0.8-8.4,2.5-11.9c1.8-3.5,4.3-6.3,7.6-8.3c3.4-2,7.5-3.1,12.3-3.1c6.6,0,11.7,1.6,15.3,4.9 c3.6,3.2,5.6,7.5,5.8,12.9H386c-0.4-3.2-1.6-5.8-3.6-7.8c-2-2-4.9-3-8.9-3c-4.5,0-8,1.3-10.4,3.9c-2.4,2.5-3.6,6.7-3.6,12.5 c0,5.9,1.2,10,3.5,12.6c2.3,2.5,5.8,3.8,10.3,3.8c4,0,7.1-1,9.2-3.1c2.2-2.1,3.5-4.9,3.9-8.3h8.3c-0.1,3.3-1,6.4-2.7,9.2 c-1.6,2.8-4,5-7.2,6.7c-3.2,1.6-7,2.5-11.4,2.5c-4.8,0-8.9-1-12.3-3.1c-3.4-2-6-4.8-7.7-8.3C351.6,47.9,350.7,44,350.7,39.5z"/>
              <path fill="#F0529C" d="M303.7,41.9c0.3,9.3,5.9,14,16.9,14c5.5,0,9.3-0.8,11.4-2.5c2.1-1.7,3.2-4.2,3.2-7.5c0-2.7-0.8-4.8-2.5-6.3 c-1.6-1.6-4-2.6-7.4-3.1l-13.5-1.9c-10.1-1.4-15.1-6.6-15.1-15.7c0-5.2,1.9-9.3,5.8-12.5c3.9-3.2,9.5-4.8,17-4.8 c7.8,0,13.6,1.7,17.6,5.2c4,3.4,6.2,7.9,6.6,13.5h-8.8c-0.5-3.7-2-6.6-4.5-8.6s-6.2-3.1-11-3.1c-4.6,0-8,0.9-10.3,2.7 c-2.2,1.8-3.3,4.2-3.3,7.3c0,2.2,0.6,4.1,1.9,5.5c1.3,1.4,3.2,2.3,5.9,2.7l14.3,2.1c5.3,0.8,9.4,2.4,12.1,5 c2.8,2.5,4.2,6.1,4.2,10.8c0,12.1-7.9,18.2-23.7,18.2c-8.9,0-15.4-2-19.5-5.9c-4.1-4-6.1-9-6.1-15.1H303.7z"/>
              <path fill="#F0529C" d="M245.6,17.6h8.8v9.8c3-7.5,8.3-11.2,15.9-11.2c5.7,0,9.7,1.5,12.2,4.5c2.5,3,3.8,7.5,3.8,13.4v27.4h-8.8V34.9 c0-4.3-0.8-7.2-2.5-8.9c-1.7-1.7-4.1-2.5-7.2-2.5c-4.4,0-7.8,1.6-10,4.7c-2.2,3.1-3.3,8-3.3,14.8v18.5h-8.8V17.6z"/>
              <path fill="#F0529C" d="M215.7,62.9c-7.4,0-13-2.2-16.7-6.5c-3.7-4.3-5.5-10-5.5-16.9c0-4.4,0.8-8.3,2.5-11.9s4.1-6.3,7.5-8.3 c3.3-2,7.4-3.1,12.3-3.1c4.5,0,8.3,1,11.5,3c3.2,1.9,5.6,4.6,7.2,8c1.6,3.4,2.5,7.2,2.5,11.5c0,1.5-0.1,2.6-0.2,3.3h-34.6 c0.4,5.2,1.7,8.9,4.1,11.2c2.4,2.2,5.6,3.2,9.7,3.2c7,0,11.3-2.7,12.7-8.2h8.1c-0.5,3.9-2.5,7.3-5.8,10.3 C227.7,61.4,222.6,62.9,215.7,62.9z M228.5,35.6c-0.4-8.6-4.6-12.9-12.6-12.9c-4,0-7.1,1-9.4,3c-2.3,1.9-3.7,5.2-4.2,9.9H228.5z"/>
              <path fill="#F0529C" d="M166.5,62.9c-7.7,0-13.1-3-16.2-9V79h-8.8V17.6h8.8v7.6c3.1-6,8.5-9,16.2-9c6.7,0,11.8,2.2,15.3,6.6 c3.5,4.3,5.2,9.9,5.2,16.8c0,6.8-1.7,12.5-5.2,16.9C178.3,60.7,173.2,62.9,166.5,62.9z M150.2,39.5c0,10.9,4.8,16.3,14.4,16.3 c4.8,0,8.2-1.3,10.3-4c2.1-2.7,3.2-6.8,3.2-12.4s-1.1-9.7-3.2-12.3c-2-2.7-5.5-4-10.3-4C155,23.2,150.2,28.6,150.2,39.5z"/>
              <path fill="#F0529C" d="M102.6,63c-10,0-17.4-2.8-22.3-8.4C75.4,48.8,73,41.4,73,32.2c0-5.9,1-11.1,3.1-15.7c2.1-4.6,5.4-8.3,9.7-11 c4.4-2.7,10-4,16.8-4c6.7,0,12.3,1.3,16.7,4c4.4,2.7,7.7,6.4,9.7,11c2.1,4.6,3.2,9.9,3.2,15.7c0,5.9-1.1,11.2-3.2,15.8 c-2,4.6-5.3,8.3-9.7,11C114.9,61.6,109.3,63,102.6,63z M82.5,32.2c0,7.8,1.6,13.7,4.7,17.6c3.2,3.8,8.3,5.7,15.4,5.7 c7,0,12.1-1.9,15.3-5.7c3.2-3.9,4.8-9.7,4.8-17.6s-1.6-13.7-4.8-17.5c-3.2-3.9-8.3-5.8-15.3-5.8c-7,0-12.1,1.9-15.4,5.8 C84,18.6,82.5,24.4,82.5,32.2z"/>
            </svg>

            <Box sx={{display: 'flex', gap: '16px'}}>
              <svg xmlns="http://www.w3.org/2000/svg" width="59" height="42" viewBox="0 0 58.2 42">
                <path fill="#FAF2E9" d="M58.2,12.8c-2.1,1.3-3.5,2-5.2,3C43,21.9,33.3,28.7,25.7,37.6L22.1,42L11,24.4c2.5,2,8.7,7.5,11.2,8.7 l8.1-6.1C36,23,52,14.3,58.2,12.8z"/>
                <path fill="#FAF2E9" d="M16.2,26l0.8,0.6C14.6,20,10.6,14,5.5,9.2H0C6.4,13.7,11.9,19.4,16.2,26L16.2,26z"/>
                <path fill="#FAF2E9" d="M18,27.6l0.7,0.5c-0.3-8.3-3.4-16.7-9.3-24H4.2C11.7,11.1,16.3,19.4,18,27.6z"/>
                <path fill="#FAF2E9" d="M19.5,28.8c0.8,0.7,1.7,1.3,2.4,1.8c1.8-9.2,0.2-18.7-4.6-26.8l24.5-0.3c1.8,4,2.9,8.4,3.2,12.9 c0.7-0.4,1.4-0.7,2.1-1.1c-0.3-4.5-1.6-9.4-4-15.2H9.6C16.9,8.6,20.2,19,19.5,28.8z"/>
              </svg>

              <svg xmlns="http://www.w3.org/2000/svg" width="62" height="42" viewBox="0 0 62.46 42">
                <path fill="#FAF2E9" d="M45.84,0v7.58h5.32l-5.94,22.12S37.95.41,37.84,0h-7.69c-.11.4-7.98,29.7-7.98,29.7l-5.47-22.12h5.54V0H0v7.58h4.93s8.5,34.01,8.61,34.42h11.94c.11-.4,5.7-21.66,5.7-21.66,0,0,5.31,21.25,5.42,21.66h11.94c.11-.41,9.05-34.42,9.05-34.42h4.89V0h-16.62Z"/>
              </svg>
            </Box>
          </Box>

          <MessageBar onSend={handleSubmit} />      
          <div>
            {isLoading && <CircularProgress />}
          </div>
        </Box>
      </Box>
    </>
  );
};
