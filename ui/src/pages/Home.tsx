import {
  alpha,
  Box,
  Grid,
  Link,
  styled,
  Typography
} from '@mui/material';
import React, { useCallback } from 'react';
import { useNavigate } from "react-router-dom";
import MessageBar from '../components/widgets/MessageBar';

import { createTask } from '../api/utils';
import { useQueryHistory } from '../components/shared';

const SUGGESTIONS: { link: string, shortName: string }[] = [
  // {link: 'https://openscholar.allen.ai/query/303bed4a-3988-42a4-a60f-d321a698b66e', shortName: 'Compare two papers'},
  // {link: 'https://openscholar.allen.ai/query/9cc9b2f9-52d4-4660-9845-4e1272d178a4', shortName: 'SWE-bench leaderboard'},
  // {link: 'https://openscholar.allen.ai/query/28cd2f86-22fa-4168-9220-340daf0c8ec6', shortName: 'Scaling retrieval-augmented LMs'}
  { link: 'https://openscholar.allen.ai/query/96c8419a-d0df-4354-ae5b-63c2e4e454b0', shortName: 'Find papers on a topic' },
  { link: 'https://openscholar.allen.ai/query/e5e6d46f-fe65-4674-bbab-4c9ee8bcef58', shortName: 'Learn about a concept' },
  { link: 'https://openscholar.allen.ai/query/803b9e79-9266-4ca0-ae20-9f629379c6ae', shortName: 'Summarize a paper' },
  { link: 'https://openscholar.allen.ai/query/211ea55e-a086-431c-ac1c-2c6047a5bca2', shortName: 'Study an algorithm' },
  { link: 'https://openscholar.allen.ai/query/28cd2f86-22fa-4168-9220-340daf0c8ec6', shortName: 'Check for prior work' }
]

export const Home = () => {

  const navigate = useNavigate();

  const {history, setHistory} = useQueryHistory();

  const handleSubmit = useCallback(async (query: string, userId: string, optin: boolean = false) => {
    console.log(query)

    const newStatus = await createTask(query, optin, userId);
    console.log(newStatus, newStatus.task_id);
    if (newStatus.task_id) {
      navigate(`/query/${newStatus.task_id}`, { replace: true });
      if (!history[newStatus.task_id]) {
        setHistory({
          ...history,
          [newStatus.task_id]: {
            query: newStatus.query, taskId: newStatus.task_id, timestamp: Date.now()
          }
        });
      }
    }
  }, []);

  return (
    <>
      <Box sx={{ alignItems:'center', display: 'flex', flexGrow: '1', flexDirection: 'column', justifyContent: 'center', padding: {xs: '120px 16px 16px 16px', sm: '240px 32px 32px 32px'}, width: '100%'}}>
        <Box sx={{maxWidth: '800px', width: '100%', display: 'flex', flexDirection: 'column', gap: '24px'}}>
          <Box sx={{display: 'flex', flexDirection: 'column', gap:'4px'}}>
            {/* <Box sx={{height: {xs:'37px', sm:'52px'}, width:{xs:'360px', sm:'505px'} }}>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1959.3 201.55">
                <path fill="#EF529B" d="M49.7,87.05h-24.85v-24.03h20c2.67,0,4.84-2.21,4.84-4.92v-20.33h23.64v25.26c0,13.27-10.58,24.03-23.64,24.03ZM24.85,89.51H0v24.03h20c2.67,0,4.84,2.21,4.84,4.92v20.33h23.64v-25.26c0-13.27-10.58-24.03-23.64-24.03ZM104.24,88.28c-2.67,0-4.85-2.21-4.85-4.92v-20.33h-23.64v25.26c0,13.27,10.58,24.03,23.64,24.03h24.85v-24.03h-20ZM50.91,138.8v25.26h23.64v-20.33c0-2.71,2.17-4.92,4.84-4.92h20v-24.03h-24.85c-13.06,0-23.64,10.75-23.64,24.03Z"/>
                <path fill="#EF529B" d="M1857.13,38.19h64.02c12.46,0,21.66,2.83,27.57,8.5,5.92,5.67,8.88,13.09,8.88,22.28,0,8.56-2.39,15.42-7.18,20.58-4.78,5.04-10.64,8.12-17.56,9.25,7.8,1.13,14.16,4.34,19.07,9.63,4.91,5.16,7.37,12.28,7.37,21.34,0,10.45-3.4,18.76-10.2,24.93-6.67,6.04-16.43,9.07-29.27,9.07h-62.7V38.19ZM1917.56,148.1c7.3,0,12.66-1.89,16.05-5.67,3.53-3.9,5.29-8.88,5.29-14.92,0-14.35-8.24-21.53-24.74-21.53h-37.58v42.11h40.98ZM1914.16,91.64c7.93,0,13.73-1.57,17.38-4.72,3.77-3.15,5.66-7.99,5.66-14.54s-1.51-11.08-4.53-13.97c-3.02-3.02-8.37-4.53-16.05-4.53h-40.04v37.77h37.58Z"/>
                <path fill="#EF529B" d="M1785.39,166.8c-11.58,0-21.15-1.7-28.71-5.1-7.42-3.4-12.84-7.87-16.24-13.41-3.4-5.54-5.1-11.52-5.1-17.94,0-7.05,1.89-13.41,5.67-19.07,3.78-5.79,9.5-10.14,17.18-13.03-6.04-2.64-10.82-6.48-14.35-11.52-3.52-5.16-5.29-10.95-5.29-17.37s1.64-11.83,4.91-17c3.28-5.16,8.38-9.32,15.3-12.46,7.05-3.15,15.93-4.72,26.63-4.72s19.51,1.57,26.44,4.72c7.05,3.15,12.21,7.3,15.48,12.46,3.28,5.16,4.91,10.83,4.91,17s-1.82,11.96-5.47,17c-3.53,5.04-8.25,8.94-14.17,11.71,7.68,3.02,13.41,7.43,17.19,13.22,3.78,5.67,5.66,12.02,5.66,19.07,0,6.42-1.7,12.4-5.09,17.94-3.4,5.41-8.88,9.88-16.43,13.41-7.43,3.4-16.94,5.1-28.52,5.1ZM1754.8,128.84c0,14.98,10.19,22.47,30.59,22.47s30.59-7.49,30.59-22.47c0-6.8-2.58-12.34-7.74-16.62-5.04-4.28-12.65-6.42-22.85-6.42s-17.88,2.14-23.04,6.42c-5.04,4.28-7.55,9.82-7.55,16.62ZM1756.68,70.67c0,6.55,2.33,11.71,6.99,15.49,4.66,3.65,11.9,5.48,21.72,5.48s17.06-1.83,21.72-5.48c4.66-3.78,6.98-8.94,6.98-15.49,0-6.17-2.32-11.02-6.98-14.54-4.54-3.65-11.77-5.48-21.72-5.48s-17.25,1.83-21.91,5.48c-4.53,3.53-6.8,8.37-6.8,14.54Z"/>
                <path fill="#EF529B" d="M1720.24,109.39v14.16h-75.54v-14.16h75.54Z"/>
                <path fill="#EF529B" d="M1581.25,69.35h18.7v22.85c6.54-16.24,17.68-24.36,33.42-24.36h2.84v18.32h-4.73c-11.96,0-20.2,3.46-24.74,10.39-4.4,6.8-6.61,17.19-6.61,31.16v36.07h-18.88v-94.42Z"/>
                <path fill="#EF529B" d="M1506.24,166.23c-9.69,0-17.37-2.45-23.04-7.36-5.54-4.91-8.31-11.71-8.31-20.4,0-7.81,2.21-14.04,6.61-18.7,4.54-4.78,11.9-8.06,22.1-9.82l23.6-3.97c4.66-.76,8-1.95,10.01-3.59,2.14-1.64,3.21-4.09,3.21-7.37,0-4.66-1.57-8.18-4.72-10.58-3.02-2.52-8.37-3.78-16.05-3.78s-13.47,1.51-17.37,4.53c-3.78,3.02-5.92,7.55-6.42,13.6h-18.89c.13-10.2,3.84-18.19,11.14-23.98,7.31-5.79,17.57-8.69,30.79-8.69s22.34,2.64,28.89,7.93c6.67,5.29,10.01,12.4,10.01,21.34v46.83c0,6.93.31,14.1.94,21.53h-17.18c-.76-7.43-1.14-14.54-1.14-21.34-2.14,6.8-6.04,12.46-11.7,17-5.67,4.53-13.16,6.8-22.48,6.8ZM1493.78,137.72c0,4.41,1.45,7.87,4.34,10.39,3.02,2.39,7.05,3.59,12.09,3.59,9.57,0,16.99-3.15,22.28-9.44,5.29-6.42,7.93-14.54,7.93-24.36v-5.67c-2.26,1.64-4.72,2.96-7.36,3.97-2.64.88-5.79,1.76-9.44,2.64l-13.03,3.02c-5.92,1.38-10.2,3.34-12.85,5.85-2.64,2.39-3.96,5.73-3.96,10.01Z"/>
                <path fill="#EF529B" d="M1435.19,31.58h18.89v132.2h-18.89V31.58Z"/>
                <path fill="#EF529B" d="M1366.83,166.8c-10.58,0-19.51-2.2-26.82-6.61-7.3-4.41-12.78-10.39-16.43-17.94-3.65-7.68-5.47-16.3-5.47-25.87s1.82-17.94,5.47-25.49c3.65-7.55,9.13-13.53,16.43-17.94,7.31-4.41,16.24-6.61,26.82-6.61s19.51,2.2,26.82,6.61c7.3,4.41,12.78,10.45,16.43,18.13,3.65,7.55,5.47,15.99,5.47,25.31s-1.82,18-5.47,25.68c-3.65,7.55-9.13,13.6-16.43,18.13-7.31,4.41-16.24,6.61-26.82,6.61ZM1337.18,116.56c0,12.46,2.33,21.47,6.99,27.01,4.78,5.41,12.34,8.12,22.66,8.12s17.81-2.71,22.47-8.12c4.79-5.54,7.18-14.54,7.18-27.01s-2.39-21.4-7.18-26.82c-4.66-5.54-12.15-8.31-22.47-8.31s-17.88,2.77-22.66,8.31c-4.66,5.41-6.99,14.35-6.99,26.82Z"/>
                <path fill="#EF529B" d="M1213.14,31.58h18.89v58.92c6.55-16.12,17.94-24.17,34.18-24.17,12.21,0,20.96,3.21,26.25,9.63,5.42,6.42,8.12,16.05,8.12,28.89v58.92h-18.88v-57.22c0-9.19-1.83-15.55-5.48-19.07-3.65-3.65-8.81-5.48-15.49-5.48-9.56,0-16.74,3.34-21.52,10.01-4.79,6.67-7.18,17.31-7.18,31.92v39.85h-18.89V31.58Z"/>
                <path fill="#EF529B" d="M1099.93,116.56c0-9.57,1.83-18.13,5.48-25.68,3.78-7.55,9.25-13.53,16.43-17.94,7.3-4.41,16.11-6.61,26.44-6.61,14.23,0,25.18,3.53,32.86,10.58,7.8,6.92,11.96,16.18,12.46,27.76h-17.75c-.88-6.92-3.46-12.53-7.74-16.81-4.28-4.28-10.64-6.42-19.08-6.42-9.69,0-17.12,2.77-22.28,8.31-5.16,5.41-7.74,14.35-7.74,26.82s2.51,21.59,7.55,27.01c5.04,5.41,12.4,8.12,22.1,8.12,8.68,0,15.29-2.2,19.83-6.61,4.65-4.53,7.42-10.45,8.31-17.75h17.75c-.25,7.18-2.21,13.79-5.86,19.83-3.52,5.92-8.68,10.7-15.48,14.35-6.8,3.52-14.99,5.29-24.55,5.29-10.33,0-19.14-2.2-26.44-6.61-7.3-4.41-12.84-10.39-16.62-17.94s-5.67-16.12-5.67-25.68Z"/>
                <path fill="#EF529B" d="M998.78,121.66c.63,20.02,12.72,30.03,36.26,30.03,11.84,0,20.02-1.83,24.55-5.48,4.54-3.65,6.8-9,6.8-16.05,0-5.79-1.76-10.32-5.28-13.6-3.4-3.4-8.69-5.6-15.87-6.61l-29.08-4.15c-21.66-3.02-32.48-14.29-32.48-33.8,0-11.08,4.15-20.02,12.46-26.82,8.31-6.92,20.52-10.39,36.64-10.39s29.33,3.71,37.77,11.14c8.56,7.3,13.28,17,14.16,29.08h-18.88c-1.01-7.93-4.22-14.1-9.63-18.51-5.42-4.41-13.29-6.61-23.61-6.61s-17.19,1.95-22.1,5.85c-4.78,3.78-7.17,9-7.17,15.67,0,4.78,1.38,8.75,4.15,11.9,2.77,3.02,6.99,4.97,12.65,5.85l30.79,4.53c11.45,1.64,20.14,5.22,26.06,10.76,6.04,5.41,9.06,13.16,9.06,23.23,0,26.06-16.99,39.09-50.99,39.09-19.13,0-33.11-4.22-41.92-12.65-8.81-8.56-13.22-19.39-13.22-32.48h18.88Z"/>
                <path fill="#EF529B" d="M873.8,69.35h18.89v21.15c6.55-16.12,17.94-24.17,34.18-24.17,12.21,0,20.96,3.21,26.25,9.63,5.41,6.42,8.12,16.05,8.12,28.89v58.92h-18.88v-57.22c0-9.19-1.83-15.55-5.48-19.07-3.65-3.65-8.81-5.48-15.49-5.48-9.57,0-16.74,3.34-21.53,10.01-4.78,6.67-7.18,17.31-7.18,31.92v39.85h-18.89v-94.43Z"/>
                <path fill="#EF529B" d="M809.66,166.8c-15.99,0-27.95-4.66-35.88-13.97-7.93-9.32-11.9-21.47-11.9-36.45,0-9.44,1.76-17.94,5.29-25.49,3.53-7.55,8.88-13.53,16.05-17.94,7.18-4.41,15.99-6.61,26.44-6.61,9.69,0,17.94,2.14,24.74,6.42,6.92,4.15,12.09,9.88,15.48,17.19,3.53,7.3,5.29,15.55,5.29,24.74,0,3.15-.13,5.54-.38,7.18h-74.41c.75,11.2,3.71,19.2,8.88,23.98,5.16,4.66,12.15,6.99,20.96,6.99,15.11,0,24.24-5.85,27.38-17.56h17.37c-1.13,8.31-5.29,15.67-12.46,22.1-7.05,6.29-18,9.44-32.86,9.44ZM837.05,108.07c-.88-18.51-9.95-27.76-27.2-27.76-8.56,0-15.3,2.14-20.21,6.42-4.91,4.15-7.93,11.27-9.07,21.34h56.47Z"/>
                <path fill="#EF529B" d="M703.73,166.8c-16.62,0-28.27-6.42-34.94-19.26v54.01h-18.89V69.35h18.89v16.24c6.67-12.84,18.32-19.26,34.94-19.26,14.48,0,25.43,4.72,32.86,14.16,7.43,9.32,11.14,21.34,11.14,36.07s-3.71,26.82-11.14,36.26c-7.43,9.32-18.38,13.97-32.86,13.97ZM668.79,116.56c0,23.42,10.32,35.13,30.97,35.13,10.32,0,17.69-2.83,22.1-8.5,4.53-5.79,6.8-14.67,6.8-26.63s-2.27-20.77-6.8-26.44c-4.41-5.79-11.77-8.69-22.1-8.69-20.65,0-30.97,11.71-30.97,35.13Z"/>
                <path fill="#EF529B" d="M566.24,166.99c-21.4,0-37.39-6.04-47.97-18.13-10.45-12.21-15.67-28.2-15.67-47.97,0-12.59,2.2-23.86,6.61-33.8,4.53-9.95,11.52-17.81,20.96-23.61,9.57-5.79,21.59-8.69,36.07-8.69s26.44,2.9,35.88,8.69c9.57,5.79,16.55,13.66,20.96,23.61,4.53,9.95,6.8,21.21,6.8,33.8s-2.27,24.05-6.8,33.99c-4.41,9.95-11.39,17.81-20.96,23.61-9.44,5.67-21.4,8.5-35.88,8.5ZM522.99,100.89c0,16.87,3.4,29.46,10.2,37.77,6.93,8.18,17.94,12.27,33.05,12.27s26.06-4.09,32.86-12.27c6.93-8.31,10.39-20.9,10.39-37.77s-3.46-29.4-10.39-37.58c-6.8-8.31-17.75-12.46-32.86-12.46s-26.12,4.15-33.05,12.46c-6.8,8.18-10.2,20.71-10.2,37.58Z"/>
                <path fill="#EF529B" d="M338.04,148.1l64.21-51.93c5.29-4.28,8.88-8.25,10.77-11.9,2.01-3.65,3.02-7.93,3.02-12.84,0-6.17-2.01-11.14-6.04-14.92-3.9-3.78-10.01-5.67-18.32-5.67-11.71,0-20.27,3.34-25.68,10.01-5.29,6.55-7.93,15.67-7.93,27.38h-20.4c.25-14.73,4.47-27.32,12.65-37.77,8.18-10.45,21.97-15.67,41.36-15.67,15.61,0,26.94,3.46,33.99,10.39,7.18,6.92,10.77,15.61,10.77,26.06,0,8.18-2.45,15.74-7.36,22.66-4.91,6.92-13.16,14.92-24.74,23.98l-38.34,30.22h72.71v15.68h-100.66v-15.68Z"/>
                <path fill="#EF529B" d="M314.1,163.78h-18.89v-73.65c0-1.38-.32-2.33-.94-2.83-.5-.63-1.45-.94-2.83-.94h-12.46v-17h14.35c6.17,0,11.14,1.89,14.92,5.67,3.78,3.65,5.73,8.5,5.85,14.54v74.22ZM288.04,38.19h23.8v17h-23.8v-17Z"/>
                <path fill="#EF529B" d="M254.62,163.78l-11.14-29.84h-60.81l-11.14,29.84h-19.64l46.65-125.59h29.27l46.65,125.59h-19.83ZM237.63,118.26l-24.55-66.29-24.55,66.29h49.1Z"/>
              </svg>
            </Box> */}
            <Typography variant="body1">
              A joint project between <Link href="https://www.semanticscholar.org" target="_blank" sx={{ color: 'rgba(15, 203, 140, 1)' }}>Semantic Scholar</Link> and the <Link href="https://www.washington.edu" target="_blank" sx={{ color: 'rgba(15, 203, 140, 1)' }}>University of Washington</Link>, we train and release <Link href="https://huggingface.co/OpenScholar" target="_blank" sx={{ fontFamily: 'monospace', fontWeight: 'bold', letterSpacing: '0.01em'  }}>scholarqa-open-8B</Link>, a fully open, retrieval-augmented language model that can synthesize 8M+ open access research papers to answer scientific questions.
            </Typography>
          </Box>
          
          <Box sx={{display: 'flex', flexDirection: 'column', gap:'8px'}}>
            <MessageBar onSend={handleSubmit} />
            <Grid
              container
              direction={{ xs: 'column', sm: 'row' }}
              spacing={1}
              sx={{ alignItems: 'center' }}
            >
              {SUGGESTIONS.map((suggestion) => (
                <Grid item key={suggestion.link}>
                  <SuggestedPrompt href={suggestion.link}>
                    {suggestion.shortName}
                  </SuggestedPrompt>
                </Grid>
              ))}
            </Grid>
            <Typography variant="body1">
              You can download the <Link href="https://huggingface.co/OpenScholar" target="_blank">model</Link>, <Link href="https://huggingface.co/OpenScholar" target="_blank">index</Link>, and <Link href="https://huggingface.co/OpenScholar" target="_blank">dataset</Link> from HuggingFace. 
              To learn more about the project, read <Link href="https://arxiv.org/abs/2411.14199" target="_blank">our paper</Link>.
            </Typography>
          </Box>
        </Box>
      </Box>
    </>
  );
};

const SuggestedPrompt = styled('a')`
  border: 1px solid ${({ theme }) => alpha(theme.color['off-white'].hex, 0.1)};
  border-radius: 6px;
  color: ${({ theme }) => theme.color.N1.hex};
  display: flex;
  font-size: ${({ theme }) => theme.font.size.md};
  gap: ${({ theme }) => theme.spacing(1)};
  line-height: ${({ theme }) => theme.spacing(3)};
  margin-bottom: ${({ theme }) => theme.spacing(0.5)};
  padding: ${({ theme }) => theme.spacing(1, 1.5)};
  text-decoration: none !important;

  :hover {
    color: ${({ theme }) => theme.color.N5.hex};
  }

  & .MuiSvgIcon-root {
    color: ${({ theme }) => theme.color['green-100'].hex};
  }
`;